<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AboElfadl Code Editor</title>
    <!-- تحميل Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* استخدام خط Inter الافتراضي */
        body {
            font-family: 'Inter', sans-serif;
            /* خلفية داكنة بنقاط شبكية */
            background-color: #0f172a; /* bg-slate-900 */
            background-image: radial-gradient(circle at 1px 1px, rgba(255,255,255,0.1) 1px, transparent 0);
            background-size: 20px 20px;
        }

        /* إخفاء شريط التمرير في الـ iframe */
        #previewFrame::-webkit-scrollbar { display: none; }
        #previewFrame { scrollbar-width: none; }

        /* تخصيص شريط التمرير للمحرر (Webkit) */
        textarea::-webkit-scrollbar {
            width: 10px;
        }
        textarea::-webkit-scrollbar-track {
            background: #1e293b; /* bg-slate-800 */
            border-radius: 10px;
        }
        textarea::-webkit-scrollbar-thumb {
            background-image: linear-gradient(to bottom, #8b5cf6, #3b82f6); /* from-purple-500 to-blue-500 */
            border-radius: 10px;
        }
        textarea::-webkit-scrollbar-thumb:hover {
            background-image: linear-gradient(to bottom, #a78bfa, #60a5fa); /* from-purple-400 to-blue-400 */
        }
    </style>
</head>
<body class="bg-slate-900 text-gray-200">

    <!-- رسالة التنبيه (Toast) -->
    <div id="toast" class="hidden fixed top-20 left-1/2 -translate-x-1/2 bg-gradient-to-r from-green-500 to-cyan-500 text-white py-2 px-6 rounded-lg shadow-xl z-50 transition-all duration-300">
        تم النسخ بنجاح!
    </div>

    <!-- مودال تأكيد الحذف -->
    <div id="deleteModal" class="hidden fixed inset-0 bg-black bg-opacity-75 z-40 flex items-center justify-center p-4" dir="rtl">
        <div class="bg-slate-800 rounded-lg shadow-xl p-6 max-w-sm w-full border border-slate-700">
            <h3 class="text-xl font-bold text-red-500 mb-4">تأكيد الحذف</h3>
            <p class="text-gray-300 mb-6">هل أنت متأكد أنك تريد مسح كل الكود؟</p>
            <div class="flex justify-end gap-4">
                <button id="cancelDeleteButton" class="py-2 px-5 bg-gray-600 rounded-lg text-white font-semibold transition-all duration-300 hover:bg-gray-500">
                    إلغاء
                </button>
                <button id="confirmDeleteButton" class="py-2 px-5 bg-red-600 rounded-lg text-white font-semibold transition-all duration-300 hover:bg-red-700">
                    حذف
                </button>
            </div>
        </div>
    </div>

    <!-- مودال التحميل باسم ملف -->
    <div id="downloadModal" class="hidden fixed inset-0 bg-black bg-opacity-75 z-40 flex items-center justify-center p-4" dir="rtl">
        <div class="bg-slate-800 rounded-lg shadow-xl p-6 max-w-sm w-full border border-slate-700">
            <h3 class="text-xl font-bold text-cyan-400 mb-4">تحميل الكود</h3>
            <label for="filenameInput" class="text-gray-300 mb-2 block">الرجاء إدخال اسم الملف:</label>
            <input type="text" id="filenameInput" class="w-full p-2 rounded-lg bg-slate-700 text-gray-200 border border-slate-600 focus:outline-none focus:ring-2 focus:ring-purple-500 mb-6" dir="ltr" />
            <div class="flex justify-end gap-4">
                <button id="cancelDownloadButton" class="py-2 px-5 bg-gray-600 rounded-lg text-white font-semibold transition-all duration-300 hover:bg-gray-500">
                    إلغاء
                </button>
                <button id="confirmDownloadButton" class="py-2 px-5 bg-blue-600 rounded-lg text-white font-semibold transition-all duration-300 hover:bg-blue-700">
                    تحميل
                </button>
            </div>
        </div>
    </div>

    <!-- 
      [تعديل] زر إظهار/إخفاء شريط الأدوات 
      - تم تغيير duration-200 إلى duration-300 ease-in-out
    -->
    <button id="toggleToolbarButton" class="fixed top-1/2 right-4 -translate-y-1/2 z-40 p-2 bg-slate-800/50 backdrop-blur-md rounded-lg border border-slate-700 shadow-xl text-gray-300 hover:text-cyan-400 transition-all duration-300 ease-in-out">
        <!-- أيقونة "افتح" (سهم لليسار) -->
        <svg id="openIcon" xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7" />
        </svg>
        <!-- أيقونة "اغلق" (سهم لليمين) - مخفية -->
        <svg id="closeIcon" xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7" />
        </svg>
    </button>
    
    <!-- 
      [تعديل] شريط الأدوات الجانبي
      - أضفنا "w-16" لتحديد العرض (4rem)
    -->
    <div id="toolbar" class="fixed top-1/2 right-4 -translate-y-1/2 z-30 flex flex-col gap-4 p-3 bg-slate-800/50 backdrop-blur-md rounded-lg border border-slate-700 shadow-xl transition-transform duration-300 ease-in-out translate-x-full w-16">
        
        <!-- زر التحميل -->
        <button id="downloadButton" title="تحميل الكود" class="p-2 rounded-lg text-gray-300 hover:bg-slate-700 hover:text-blue-400 transition-all duration-200">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
            </svg>
        </button>

        <!-- زر المسح -->
        <button id="deleteButton" title="مسح الكل" class="p-2 rounded-lg text-gray-300 hover:bg-slate-700 hover:text-red-500 transition-all duration-200">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
            </svg>
        </button>

        <!-- زر اللصق -->
        <button id="pasteButton" title="لصق" class="p-2 rounded-lg text-gray-300 hover:bg-slate-700 hover:text-purple-400 transition-all duration-200">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2" />
            </svg>
        </button>

        <!-- زر النسخ -->
        <button id="copyButton" title="نسخ" class="p-2 rounded-lg text-gray-300 hover:bg-slate-700 hover:text-cyan-400 transition-all duration-200">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 4h8a2 2 0 002-2V8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" />
            </svg>
        </button>
        
        <!-- زر رفع الملف (مصمم كـ label) -->
        <label for="fileUpload" title="رفع ملف" class="p-2 rounded-lg text-gray-300 hover:bg-slate-700 hover:text-green-400 transition-all duration-200 cursor-pointer">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12" />
            </svg>
        </label>
        <input type="file" id="fileUpload" class="hidden" accept=".html,.css,.js,.txt">
    </div>


    <div class="flex flex-col h-screen">
        
        <!-- العنوان (بتأثير زجاجي) -->
        <header class="w-full bg-slate-800/50 backdrop-blur-md shadow-lg z-10 border-b border-slate-700">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex justify-center items-center h-16">
                    <h1 class="text-2xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-purple-400 to-cyan-400">
                        AboElfadl Code
                    </h1>
                </div>
            </div>
        </header>

        <!-- المحرر والمعاينة -->
        <main class="flex-1 flex flex-col overflow-hidden">
            
            <!-- لوحة المعاينة (الأعلى) -->
            <div class="w-full h-1/2 flex flex-col transition-all duration-300 focus-within:ring-2 focus-within:ring-purple-500">
                <div class="p-3 bg-slate-800/30 border-b border-slate-700">
                    <h2 class="text-sm font-semibold text-gray-300">المعاينة الفورية</h2>
                </div>
                <iframe id="previewFrame" class="w-full h-full border-0 bg-white" title="المعاينة الفورية"></iframe>
            </div>

            <!-- لوحة المحرر (الأسفل) -->
            <div class="w-full h-1/2 flex flex-col border-t border-slate-700 transition-all duration-300 focus-within:ring-2 focus-within:ring-indigo-500">
                <div class="p-3 bg-slate-800/30 border-b border-slate-700">
                    <h2 class="text-sm font-semibold text-gray-300">الكود (HTML/CSS/JS)</h2>
                </div>
                <textarea 
                    id="codeInput" 
                    class="w-full h-full p-4 border-0 resize-none outline-none bg-slate-900 text-green-300 font-mono text-sm placeholder-gray-600" 
                    placeholder="اكتب الكود هنا أو قم برفع ملف..." 
                    style="direction: ltr; text-align: left;"><style>
  body {
    font-family: 'Inter', sans-serif;
    background-color: #f3f4f6;
    display: grid;
    place-items: center;
    min-height: 90vh;
    color: #1f2937;
  }
  .card {
    background-image: linear-gradient(to top right, #8b5cf6, #3b82f6);
    color: white;
    padding: 2rem;
    border-radius: 1.5rem;
    box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
    text-align: center;
  }
  h1 {
    font-size: 2.25rem;
    font-weight: bold;
    margin-bottom: 1rem;
  }
  button {
    background-color: white;
    color: #6366f1;
    padding: 0.75rem 1.5rem;
    border: none;
    border-radius: 0.75rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
  }
  button:hover {
    transform: scale(1.1);
    box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
  }
</style>

<div class="card">
  <h1>أهلاً بك في AboElfadl Code!</h1>
  <p>جرب تعديل هذا الكود.</p>
  <button id="myButton">اضغطني!</button>
</div>

<script>
  document.getElementById('myButton').onclick = function() {
    this.textContent = 'تم الضغط!';
  };
</script>
</textarea>
            </div>

        </main>
    </div>

    <script>
        // --- العناصر الأساسية ---
        const codeInput = document.getElementById('codeInput');
        const previewFrame = document.getElementById('previewFrame');
        const fileUpload = document.getElementById('fileUpload');
        const copyButton = document.getElementById('copyButton');
        const pasteButton = document.getElementById('pasteButton');
        const deleteButton = document.getElementById('deleteButton');
        const downloadButton = document.getElementById('downloadButton');
        const toast = document.getElementById('toast');
        
        // عناصر مودال الحذف
        const deleteModal = document.getElementById('deleteModal');
        const confirmDeleteButton = document.getElementById('confirmDeleteButton');
        const cancelDeleteButton = document.getElementById('cancelDeleteButton');

        // عناصر مودال التحميل
        const downloadModal = document.getElementById('downloadModal');
        const confirmDownloadButton = document.getElementById('confirmDownloadButton');
        const cancelDownloadButton = document.getElementById('cancelDownloadButton');
        const filenameInput = document.getElementById('filenameInput');
        
        // عنصر شريط الأدوات
        const toolbar = document.getElementById('toolbar');

        // عناصر زر التبديل
        const toggleToolbarButton = document.getElementById('toggleToolbarButton');
        const openIcon = document.getElementById('openIcon');
        const closeIcon = document.getElementById('closeIcon');

        let toastTimeout;

        // --- الدوال الوظيفية (كما هي) ---

        function showToast(message, isError = false) {
            if (toastTimeout) clearTimeout(toastTimeout);
            toast.textContent = message;
            toast.classList.remove('hidden', 'from-green-500', 'to-cyan-500', 'from-red-500', 'to-orange-500');
            if (isError) {
                toast.classList.add('from-red-500', 'to-orange-500');
            } else {
                toast.classList.add('from-green-500', 'to-cyan-500');
            }
            toast.classList.remove('hidden');
            toastTimeout = setTimeout(() => {
                toast.classList.add('hidden');
            }, 2000);
        }

        function updatePreview() {
            try {
                const code = codeInput.value;
                const previewDoc = previewFrame.contentWindow.document;
                previewDoc.open();
                previewDoc.write(code);
                previewDoc.close();
            } catch (e) {
                console.error("خطأ في تحديث المعاينة:", e);
            }
        }

        function handleFileUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = function(e) {
                codeInput.value = e.target.result;
                updatePreview();
                showToast("تم تحميل الملف بنجاح!");
            };
            reader.readAsText(file);
            event.target.value = null;
        }

        async function copyCode() {
            try {
                await navigator.clipboard.writeText(codeInput.value);
                showToast("تم النسخ إلى الحافظة!");
            } catch (err) {
                showToast("فشل النسخ.", true);
            }
        }

        async function pasteCode() {
            try {
                const text = await navigator.clipboard.readText();
                if (text) {
                    if (document.execCommandSupported('insertText') && document.activeElement === codeInput) {
                        document.execCommand('insertText', false, text);
                    } else {
                        const start = codeInput.selectionStart;
                        const end = codeInput.selectionEnd;
                        codeInput.value = codeInput.value.substring(0, start) + text + codeInput.value.substring(end);
                        codeInput.selectionStart = codeInput.selectionEnd = start + text.length;
                    }
                    updatePreview();
                    showToast("تم اللصق من الحافظة!");
                }
            } catch (err) {
                showToast("فشل اللصق.", true);
            }
        }

        function showDeleteModal() { if(deleteModal) deleteModal.classList.remove('hidden'); }
        function hideDeleteModal() { if(deleteModal) deleteModal.classList.add('hidden'); }
        function executeDelete() {
            codeInput.value = "";
            updatePreview();
            hideDeleteModal();
            showToast("تم مسح الكود بنجاح!");
        }

        function showDownloadModal() {
            const code = codeInput.value.trim();
            let defaultName = 'index.html';
            if (code.startsWith('<')) defaultName = 'index.html';
            else if (code.includes('{') && code.includes('}')) defaultName = 'style.css';
            else if (code.includes('function') || code.includes('const')) defaultName = 'script.js';
            
            if(filenameInput) filenameInput.value = defaultName;
            if(downloadModal) downloadModal.classList.remove('hidden');
            if(filenameInput) { filenameInput.focus(); filenameInput.select(); }
        }

        function hideDownloadModal() { if(downloadModal) downloadModal.classList.add('hidden'); }

        function executeDownload() {
            const code = codeInput.value;
            let filename = (filenameInput && filenameInput.value.trim()) ? filenameInput.value.trim() : 'code.txt';
            const blob = new Blob([code], { type: 'text/plain;charset=utf-8' });
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(a.href);
            hideDownloadModal();
            showToast(`تم بدء تحميل ${filename}!`);
        }

        // --- ربط الأحداث ---
        if(codeInput) codeInput.addEventListener('input', updatePreview);
        window.addEventListener('load', updatePreview);
        if(fileUpload) fileUpload.addEventListener('change', handleFileUpload);
        if(copyButton) copyButton.addEventListener('click', copyCode);
        if(pasteButton) pasteButton.addEventListener('click', pasteCode);
        if(deleteButton) deleteButton.addEventListener('click', showDeleteModal);
        if(confirmDeleteButton) confirmDeleteButton.addEventListener('click', executeDelete);
        if(cancelDeleteButton) cancelDeleteButton.addEventListener('click', hideDeleteModal);
        if(downloadButton) downloadButton.addEventListener('click', showDownloadModal);
        if(confirmDownloadButton) confirmDownloadButton.addEventListener('click', executeDownload);
        if(cancelDownloadButton) cancelDownloadButton.addEventListener('click', hideDownloadModal);

        // --- [تعديل] ربط حدث زر تبديل شريط الأدوات ---
        if (toggleToolbarButton && toolbar && openIcon && closeIcon) {
            toggleToolbarButton.addEventListener('click', () => {
                const isHidden = toolbar.classList.contains('translate-x-full');
                if (isHidden) {
                    // إظهار الشريط
                    toolbar.classList.remove('translate-x-full');
                    // تحريك الزر إلى اليسار ( -4rem هو -w-16)
                    toggleToolbarButton.classList.add('-translate-x-16'); 
                    
                    // تغيير الأيقونة إلى "إغلاق"
                    openIcon.classList.add('hidden');
                    closeIcon.classList.remove('hidden');
                } else {
                    // إخفاء الشريط
                    toolbar.classList.add('translate-x-full');
                    // إعادة الزر إلى مكانه الأصلي
                    toggleToolbarButton.classList.remove('-translate-x-16'); 
                    
                    // تغيير الأيقونة إلى "فتح"
                    openIcon.classList.remove('hidden');
                    closeIcon.classList.add('hidden');
                }
            });
        }
        
    </script>

</body>
</html>



